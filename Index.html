<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de Infrações</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background: #37474f;
      color: #fff;
      padding: 16px;
      text-align: center;
    }
    .container {
      max-width: 960px;
      margin: 20px auto;
      padding: 0 16px;
    }
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .tab-btn {
      flex: 1;
      padding: 12px;
      border: none;
      background: #e0e0e0;
      color: #333;
      cursor: pointer;
      border-radius: 6px;
      font-weight: bold;
      transition: background 0.2s ease, color 0.2s ease;
    }
    .tab-btn.active {
      background: #1565c0;
      color: #fff;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      margin-bottom: 16px;
    }
    .form-group {
      margin-bottom: 12px;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
    }
    input[type="text"], select, textarea, input[type="date"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }
    textarea { resize: vertical; min-height: 80px; }
    .actions { margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap; }
    button {
      padding: 10px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      background: #1565c0;
      color: #fff;
    }
    button.secondary { background: #78909c; }
    .message { margin-top: 8px; font-weight: bold; }
    .message.success { color: #2e7d32; }
    .message.error { color: #c62828; }
    #paretoContainer {
      position: relative;
      height: 320px;
    }
    #paretoChart {
      width: 100% !important;
      height: 100% !important;
      display: block;
      background: #fff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #eee;
      text-align: left;
      font-size: 14px;
    }
    th { background: #f5f5f5; }
    .badge-yes { color: #2e7d32; font-weight: bold; }
    .badge-no { color: #c62828; font-weight: bold; }
    .hidden { display: none; }
    .tarefa-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-top: 8px;
    }
    .tarefa-button {
      padding: 12px;
      background: #eceff1;
      border-radius: 6px;
      border: 2px solid transparent;
      cursor: pointer;
      text-align: left;
      transition: all 0.2s ease;
      font-weight: bold;
      color: #2c2c2c;
    }
    .tarefa-button:hover { background: #e0e0e0; }
    .tarefa-button.selected {
      border-color: #1565c0;
      background: #e3f2fd;
      color: #0d47a1;
    }
    .login-card {
      max-width: 480px;
    }
    .app-hidden { display: none; }
    .hidden-field { display: none; }
    @media (max-width: 640px) {
      th, td { font-size: 12px; }
      .tab-btn { flex: 1 1 100%; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Controle de Infrações do Podcast</h1>
  </header>
  <div class="container">
    <div id="loginSection" class="card login-card">
      <h2>Login</h2>
      <div class="form-group">
        <label for="loginUsuario">Usuário</label>
        <input type="text" id="loginUsuario" placeholder="bruno ou alexandre" />
      </div>
      <div class="form-group">
        <label for="loginSenha">Senha</label>
        <input type="password" id="loginSenha" />
      </div>
      <div class="actions">
        <button id="btnLogin">Entrar</button>
      </div>
      <div id="msgLogin" class="message"></div>
    </div>

    <div id="appSection" class="app-hidden">
      <div class="card" id="usuarioInfo" style="margin-bottom: 12px;">
        <strong>Usuário logado:</strong> <span id="usuarioLogado"></span>
      </div>
    <div class="tabs">
      <button class="tab-btn active" data-tab="tab-infracao">Registrar infração</button>
      <button class="tab-btn" data-tab="tab-tarefas">Gerenciar tarefas</button>
      <button class="tab-btn" data-tab="tab-historico">Histórico</button>
    </div>

    <div id="tab-infracao" class="card tab-content active">
      <div class="form-group">
        <label>Tarefas do outro responsável</label>
        <div id="tarefaButtons" class="tarefa-buttons"></div>
      </div>
      <div class="form-group hidden-field">
        <label for="tarefaSelecionadaNome">Tarefa selecionada</label>
        <input type="text" id="tarefaSelecionadaNome" readonly placeholder="Nenhuma tarefa selecionada" />
      </div>
      <div class="form-group hidden-field">
        <label for="responsavel">Responsável</label>
        <input type="text" id="responsavel" readonly />
      </div>
      <div class="form-group hidden-field">
        <label>Dia limite da tarefa</label>
        <div id="infoDiaLimite">Selecione uma tarefa para ver o dia limite.</div>
      </div>
      <div class="form-group hidden-field">
        <label for="registradoPor">Registrado por</label>
        <input type="text" id="registradoPor" readonly />
      </div>
      <div class="form-group hidden-field">
        <label for="dataInfracao">Data da infração</label>
        <input type="date" id="dataInfracao" />
      </div>
      <div class="form-group">
        <label for="observacao">Observação</label>
        <textarea id="observacao" placeholder="Opcional"></textarea>
      </div>
      <div class="actions">
        <button id="btnRegistrar">Registrar infração</button>
      </div>
      <div id="msgInfracao" class="message"></div>

      <div class="card" id="paretoContainer">
        <h3>Pareto de Infrações</h3>
        <div class="form-group">
          <label for="mesPareto">Mês de referência</label>
          <input type="month" id="mesPareto" />
        </div>
        <canvas id="paretoChart" height="220"></canvas>
        <div id="paretoMensagem" class="message"></div>
      </div>
    </div>

    <div id="tab-tarefas" class="card tab-content hidden">
      <div class="form-group" hidden>
        <input type="text" id="tarefaId" />
      </div>
      <div class="form-group">
        <label for="tarefaNome">Nome da tarefa</label>
        <input type="text" id="tarefaNome" />
      </div>
      <div class="form-group">
        <label for="tarefaResponsavel">Responsável</label>
        <select id="tarefaResponsavel">
          <option value="Bruno">Bruno</option>
          <option value="Xandão">Xandão</option>
        </select>
      </div>
      <div class="form-group">
        <label for="tarefaDiaLimite">Dia da semana (data limite)</label>
        <select id="tarefaDiaLimite"></select>
      </div>
      <div class="form-group">
        <label for="tarefaAtiva">Ativa?</label>
        <select id="tarefaAtiva">
          <option value="true">Sim</option>
          <option value="false">Não</option>
        </select>
      </div>
      <div class="actions">
        <button id="btnSalvarTarefa">Salvar tarefa</button>
        <button id="btnLimparTarefa" class="secondary">Limpar formulário</button>
      </div>
      <div id="msgTarefa" class="message"></div>

      <table id="tabelaTarefas">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Responsável</th>
            <th>Dia limite</th>
            <th>Ativa</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="tab-historico" class="card tab-content hidden">
      <table id="tabelaHistorico">
        <thead>
          <tr>
            <th>Tarefa</th>
            <th>Responsável</th>
            <th>Registrado por</th>
            <th>Data da infração</th>
            <th>Registro</th>
            <th>Dentro do prazo?</th>
            <th>Conta ponto?</th>
            <th>Obs.</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    const USERS = {
      bruno: { senha: 'Cesar177*', nome: 'Bruno', podeGerenciar: true },
      alexandre: { senha: 'plus123', nome: 'Xandão', podeGerenciar: false },
    };
    const STORAGE_USER_KEY = 'pontosPlusCurrentUser';

    const diasSemana = [
      { value: 'segunda', label: 'Segunda-feira' },
      { value: 'terca', label: 'Terça-feira' },
      { value: 'quarta', label: 'Quarta-feira' },
      { value: 'quinta', label: 'Quinta-feira' },
      { value: 'sexta', label: 'Sexta-feira' },
      { value: 'sabado', label: 'Sábado' },
      { value: 'domingo', label: 'Domingo' },
    ];

    let tarefasCache = [];
    let tarefasAtivas = [];
    let paretoChart;
    let currentUser = null;
    let tarefaSelecionadaId = '';

    function getCurrentDateStr() {
      return new Date().toISOString().split('T')[0];
    }

    function showMessage(elementId, message, isError = false) {
      const el = document.getElementById(elementId);
      el.textContent = message;
      el.className = 'message ' + (isError ? 'error' : 'success');
    }

    function preencherSelectDiaLimite() {
      const select = document.getElementById('tarefaDiaLimite');
      select.innerHTML = '<option value="">Selecione o dia limite</option>';
      diasSemana.forEach((d) => {
        const option = document.createElement('option');
        option.value = d.value;
        option.textContent = d.label;
        select.appendChild(option);
      });
    }

    function obterLabelDia(valor) {
      const dia = diasSemana.find(d => d.value === valor);
      return dia ? dia.label : '';
    }

    function atualizarInfoDiaLimite(tarefa) {
      const info = document.getElementById('infoDiaLimite');
      if (!tarefa || !tarefa.diaLimite) {
        info.textContent = 'Selecione uma tarefa para ver o dia limite.';
        return;
      }
      const label = obterLabelDia(tarefa.diaLimite) || 'dia não informado';
      info.textContent = `Limite da tarefa: ${label}. Somente é possível registrar no dia seguinte a esse limite.`;
    }

    function renderizarBotoesTarefas() {
      const container = document.getElementById('tarefaButtons');
      container.innerHTML = '';
      tarefaSelecionadaId = '';
      document.getElementById('tarefaSelecionadaNome').value = '';
      document.getElementById('responsavel').value = '';
      atualizarInfoDiaLimite(null);

      if (!currentUser) return;

      const outrasTarefas = tarefasAtivas.filter((t) => t.responsavel !== currentUser.nome);
      if (!outrasTarefas.length) {
        const aviso = document.createElement('div');
        aviso.textContent = 'Nenhuma tarefa do outro responsável para registrar.';
        container.appendChild(aviso);
        return;
      }

      outrasTarefas.forEach((tarefa) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'tarefa-button';
        btn.dataset.id = tarefa.id;
        btn.textContent = `${tarefa.nome} (${tarefa.responsavel})`;
        btn.addEventListener('click', () => selecionarTarefa(tarefa.id));
        container.appendChild(btn);
      });
    }

    function selecionarTarefa(tarefaId) {
      tarefaSelecionadaId = tarefaId;
      const container = document.getElementById('tarefaButtons');
      container.querySelectorAll('.tarefa-button').forEach((btn) => {
        btn.classList.toggle('selected', btn.dataset.id === tarefaId);
      });

      const tarefa = tarefasAtivas.find((t) => t.id === tarefaId);
      document.getElementById('tarefaSelecionadaNome').value = tarefa ? tarefa.nome : '';
      document.getElementById('responsavel').value = tarefa ? tarefa.responsavel : '';
      atualizarInfoDiaLimite(tarefa);
    }

    function preencherTabelaTarefas() {
      const tbody = document.querySelector('#tabelaTarefas tbody');
      tbody.innerHTML = '';
      tarefasCache.forEach((t) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${t.nome}</td>
          <td>${t.responsavel}</td>
          <td>${obterLabelDia(t.diaLimite) || 'Não informado'}</td>
          <td>${t.ativa ? 'Sim' : 'Não'}</td>
          <td>
            <button class="secondary" onclick="editarTarefa('${t.id}')">Editar</button>
            <button class="secondary" onclick="excluirTarefa('${t.id}')">Excluir</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function loadTarefas() {
      google.script.run
        .withSuccessHandler((tarefas) => {
          tarefasCache = tarefas || [];
          tarefasAtivas = tarefasCache.filter(t => t.ativa);
          renderizarBotoesTarefas();
          preencherTabelaTarefas();
        })
        .withFailureHandler((err) => {
          showMessage('msgInfracao', 'Erro ao carregar tarefas: ' + err.message, true);
        })
        .getTarefas();
    }

    function registrarInfracao() {
      if (!currentUser) {
        showMessage('msgInfracao', 'Faça login para registrar.', true);
        return;
      }

      if (!tarefaSelecionadaId) {
        showMessage('msgInfracao', 'Selecione uma tarefa.', true);
        return;
      }

      const dataInfracao = document.getElementById('dataInfracao').value || getCurrentDateStr();
      const observacao = document.getElementById('observacao').value;

      if (!dataInfracao) {
        showMessage('msgInfracao', 'Informe a data da infração.', true);
        return;
      }

      if (!confirm('Tem Certeza?')) return;

      const payload = {
        tarefaId: tarefaSelecionadaId,
        dataInfracao,
        registradoPor: currentUser.nome,
        observacao,
      };

      google.script.run
        .withSuccessHandler((res) => {
          if (res.success) {
            showMessage('msgInfracao', res.message, false);
            document.getElementById('observacao').value = '';
            alert('Registrado');
            loadHistorico();
            loadPareto();
          } else {
            showMessage('msgInfracao', res.message, true);
          }
        })
        .withFailureHandler((err) => {
          showMessage('msgInfracao', 'Erro ao registrar: ' + err.message, true);
        })
        .registerInfracao(payload);
    }

    function aplicarPermissoesTabs() {
      const tabTarefasBtn = document.querySelector('[data-tab="tab-tarefas"]');
      const tabInfracaoBtn = document.querySelector('[data-tab="tab-infracao"]');
      if (!currentUser?.podeGerenciar) {
        tabTarefasBtn.classList.add('hidden');
        if (tabTarefasBtn.classList.contains('active')) {
          ativarTab('tab-infracao');
        }
      } else {
        tabTarefasBtn.classList.remove('hidden');
      }
      tabInfracaoBtn?.classList.add('active');
      document.getElementById('tab-infracao').classList.remove('hidden');
    }

    function ativarTab(tabId) {
      tabButtons.forEach((btn) => {
        if (btn.dataset.tab === tabId && !btn.classList.contains('hidden')) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
      tabContents.forEach((content) => {
        content.classList.toggle('hidden', content.id !== tabId);
      });
      if (tabId === 'tab-historico') {
        loadHistorico();
      }
    }

    function iniciarAposLogin() {
      document.getElementById('loginSection').classList.add('app-hidden');
      document.getElementById('appSection').classList.remove('app-hidden');
      document.getElementById('usuarioLogado').textContent = currentUser.nome;
      document.getElementById('registradoPor').value = currentUser.nome;
      aplicarPermissoesTabs();
      tarefaSelecionadaId = '';
      limparFormTarefa();
      ajustarMaxDataInfracao();
      inicializarMesPareto();
      loadTarefas();
      loadPareto();
      loadHistorico();
    }

    function salvarLoginLocal(usuarioChave) {
      try {
        localStorage.setItem(STORAGE_USER_KEY, usuarioChave);
      } catch (e) {
        console.warn('Não foi possível salvar o login localmente.', e);
      }
    }

    function restaurarLogin() {
      try {
        const savedUser = localStorage.getItem(STORAGE_USER_KEY);
        if (savedUser && USERS[savedUser]) {
          currentUser = USERS[savedUser];
          ativarTab('tab-infracao');
          iniciarAposLogin();
        }
      } catch (e) {
        console.warn('Não foi possível restaurar o login salvo.', e);
      }
    }

    function realizarLogin() {
      const usuarioInput = (document.getElementById('loginUsuario').value || '').trim().toLowerCase();
      const senhaInput = document.getElementById('loginSenha').value || '';
      const userInfo = USERS[usuarioInput];

      if (!userInfo || userInfo.senha !== senhaInput) {
        showMessage('msgLogin', 'Usuário ou senha inválidos.', true);
        return;
      }

      currentUser = userInfo;
      salvarLoginLocal(usuarioInput);
      showMessage('msgLogin', '', false);
      ativarTab('tab-infracao');
      iniciarAposLogin();
    }

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        if (btn.classList.contains('hidden')) return;
        ativarTab(btn.dataset.tab);
      });
    });

    document.getElementById('btnLogin').addEventListener('click', realizarLogin);
    document.getElementById('btnRegistrar').addEventListener('click', registrarInfracao);
    document.getElementById('btnSalvarTarefa').addEventListener('click', salvarTarefa);
    document.getElementById('btnLimparTarefa').addEventListener('click', limparFormTarefa);
    document.getElementById('mesPareto').addEventListener('change', loadPareto);

    function salvarTarefa() {
      const id = document.getElementById('tarefaId').value;
      const nome = document.getElementById('tarefaNome').value.trim();
      const responsavel = document.getElementById('tarefaResponsavel').value;
      const diaLimite = document.getElementById('tarefaDiaLimite').value;
      const ativa = document.getElementById('tarefaAtiva').value === 'true';

      if (!nome) {
        showMessage('msgTarefa', 'Informe o nome da tarefa.', true);
        return;
      }

      if (!diaLimite) {
        showMessage('msgTarefa', 'Selecione o dia limite da tarefa.', true);
        return;
      }

      const payload = { id, nome, responsavel, diaLimite, ativa };

      google.script.run
        .withSuccessHandler((res) => {
          if (res.success) {
            showMessage('msgTarefa', res.message, false);
            limparFormTarefa();
            loadTarefas();
          } else {
            showMessage('msgTarefa', res.message, true);
          }
        })
        .withFailureHandler((err) => {
          showMessage('msgTarefa', 'Erro ao salvar tarefa: ' + err.message, true);
        })
        .saveTarefa(payload);
    }

    function limparFormTarefa() {
      document.getElementById('tarefaId').value = '';
      document.getElementById('tarefaNome').value = '';
      document.getElementById('tarefaResponsavel').value = 'Bruno';
      document.getElementById('tarefaDiaLimite').value = '';
      document.getElementById('tarefaAtiva').value = 'true';
      showMessage('msgTarefa', '', false);
    }

    function editarTarefa(id) {
      const tarefa = tarefasCache.find(t => t.id === id);
      if (!tarefa) return;
      document.getElementById('tarefaId').value = tarefa.id;
      document.getElementById('tarefaNome').value = tarefa.nome;
      document.getElementById('tarefaResponsavel').value = tarefa.responsavel;
      document.getElementById('tarefaDiaLimite').value = tarefa.diaLimite || '';
      document.getElementById('tarefaAtiva').value = tarefa.ativa ? 'true' : 'false';
      showMessage('msgTarefa', 'Editando tarefa selecionada.', false);
    }

    function excluirTarefa(id) {
      if (!confirm('Deseja excluir esta tarefa?')) return;
      google.script.run
        .withSuccessHandler((res) => {
          if (res.success) {
            showMessage('msgTarefa', res.message, false);
            loadTarefas();
          } else {
            showMessage('msgTarefa', res.message, true);
          }
        })
        .withFailureHandler((err) => {
          showMessage('msgTarefa', 'Erro ao excluir tarefa: ' + err.message, true);
        })
        .deleteTarefa(id);
    }

    function loadHistorico() {
      google.script.run
        .withSuccessHandler((infracoes) => {
          const tbody = document.querySelector('#tabelaHistorico tbody');
          tbody.innerHTML = '';
          (infracoes || []).forEach((inf) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${inf.nomeTarefa}</td>
              <td>${inf.responsavel}</td>
              <td>${inf.registradoPor}</td>
              <td>${inf.dataInfracao}</td>
              <td>${inf.dataRegistro}</td>
              <td class="${inf.dentroPrazo ? 'badge-yes' : 'badge-no'}">${inf.dentroPrazo ? 'Sim' : 'Não'}</td>
              <td class="${inf.contaPonto ? 'badge-yes' : 'badge-no'}">${inf.contaPonto ? 'Sim' : 'Não'}</td>
              <td>${inf.observacao || ''}</td>
            `;
            tbody.appendChild(tr);
          });
        })
        .withFailureHandler((err) => {
          const tbody = document.querySelector('#tabelaHistorico tbody');
          tbody.innerHTML = `<tr><td colspan="8">Erro ao carregar histórico: ${err.message}</td></tr>`;
        })
        .getInfracoes();
    }

    function prepararDadosPareto(infracoes, mesSelecionado) {
      const contagem = { Bruno: 0, 'Xandão': 0 };
      const responsaveisConsiderados = ['Bruno', 'Xandão'];

      const isMesSelecionado = (dataRef) => {
        if (!mesSelecionado) return true;
        if (!dataRef || typeof dataRef !== 'string' || !dataRef.includes('-')) return false;
        const [ano, mes] = dataRef.split('-').map(Number);
        const [anoFiltro, mesFiltro] = mesSelecionado.split('-').map(Number);
        return ano === anoFiltro && mes === mesFiltro;
      };

      infracoes.forEach((inf) => {
        if (!responsaveisConsiderados.includes(inf.responsavel)) return;
        if (!inf.contaPonto) return;

        const dataReferencia = inf.dataRegistro || inf.dataInfracao;
        if (!isMesSelecionado(dataReferencia)) return;

        contagem[inf.responsavel] = (contagem[inf.responsavel] || 0) + 1;
      });

      const entries = Object.entries(contagem).sort((a, b) => b[1] - a[1]);

      const total = entries.reduce((sum, [, value]) => sum + value, 0);
      if (total === 0) {
        return { labels: [], valores: [] };
      }

      return {
        labels: entries.map(([nome]) => nome),
        valores: entries.map(([, value]) => value),
      };
    }

    function renderizarPareto(dados) {
      const mensagem = document.getElementById('paretoMensagem');
      if (!dados.labels.length) {
        mensagem.textContent = 'Nenhuma infração registrada no período selecionado.';
        mensagem.className = 'message';
        if (paretoChart) {
          paretoChart.destroy();
          paretoChart = null;
        }
        return;
      }

      mensagem.textContent = '';
      mensagem.className = 'message';

      const ctx = document.getElementById('paretoChart').getContext('2d');
      if (paretoChart) {
        paretoChart.destroy();
      }

      paretoChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: dados.labels,
          datasets: [
            {
              type: 'bar',
              label: 'Total de infrações',
              data: dados.valores,
              backgroundColor: '#1565c0',
              borderColor: '#0d47a1',
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Total',
              },
            },
          },
          plugins: {
            tooltip: {
              callbacks: {
                label: (context) => `${context.parsed.y} infrações`,
              },
            },
          },
        },
      });
    }

    function loadPareto() {
      const mesSelecionado = document.getElementById('mesPareto').value;
      google.script.run
        .withSuccessHandler((infracoes) => {
          const dados = prepararDadosPareto(infracoes || [], mesSelecionado);
          renderizarPareto(dados);
        })
        .withFailureHandler((err) => {
          const mensagem = document.getElementById('paretoMensagem');
          mensagem.textContent = 'Erro ao carregar gráfico: ' + err.message;
          mensagem.className = 'message error';
        })
        .getInfracoes();
    }

    function ajustarMaxDataInfracao() {
      const hojeStr = getCurrentDateStr();
      const input = document.getElementById('dataInfracao');
      input.value = hojeStr;
      input.readOnly = true;
      input.setAttribute('max', hojeStr);
    }

    function inicializarMesPareto() {
      const hoje = new Date();
      const mesStr = `${hoje.getFullYear()}-${String(hoje.getMonth() + 1).padStart(2, '0')}`;
      document.getElementById('mesPareto').value = mesStr;
    }

    document.addEventListener('DOMContentLoaded', () => {
      preencherSelectDiaLimite();
      ajustarMaxDataInfracao();
      inicializarMesPareto();
      restaurarLogin();
    });
  </script>
</body>
</html>
